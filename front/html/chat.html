<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Room Mate</title>
<style>
  :root{
    --bg:#fafafa; --panel:#ffffff; --line:#e5e7eb; --muted:#6b7280;
    --text:#111827; --accent:#6d28d9; --accent-weak:#ede9fe;
    --chip:#f3f4f6; --bubble:#f5f6f8; --shadow:0 10px 25px rgba(0,0,0,.08);
    --radius:16px; --sidebar-w:320px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:var(--text);background:var(--bg)}
  button{cursor:pointer;border:0;background:none;font:inherit;color:inherit}
  a{text-decoration:none;color:inherit}

  body{--ml:var(--sidebar-w);}
  .app{min-height:100vh}
  .sidebar{
    position:fixed;inset:0 auto 0 0;width:var(--sidebar-w);
    background:#fff;border-right:1px solid var(--line);
    display:flex;flex-direction:column;gap:16px;transform:translateX(0);
    transition:transform .32s ease;z-index:30;
  }
  .main{
    margin-left:var(--ml);transition:margin-left .32s ease;
    display:flex;flex-direction:column;min-height:100vh;background:#fff;
  }
  body.sidebar-closed .sidebar{transform:translateX(-100%)}
  body.sidebar-closed .main{margin-left:0}

  .brand{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid var(--line);}
  .brand h1{margin:0;font-size:28px;font-weight:800}
  .logo-link{display:inline-flex;align-items:center}
  .new-chat{display:inline-flex;align-items:center;gap:10px;background:var(--accent-weak);padding:10px 14px;border-radius:12px}
  .logs{padding:16px;height:100%;overflow:auto}
  .logs h2{margin:6px 0 12px 4px;font-size:16px;color:#111}
  .log{background:var(--chip);border:1px solid var(--line);border-radius:12px;padding:12px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;gap:8px;cursor:pointer;position:relative}
  .log small{color:var(--muted)}
  .log.active{outline:2px solid #a78bfa}
  .log-main{display:flex;flex-direction:column}
  .log-actions{margin-left:auto;display:flex;align-items:center}
  .kebab{width:28px;height:28px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;}
  .kebab:hover{background:#eef2ff}
  .log-menu{position:absolute;right:6px;top:44px;min-width:120px;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);display:none;z-index:22;overflow:hidden}
  .log.open .log-menu{display:block}
  .log-menu button{display:block;width:100%;text-align:left;padding:10px 12px}
  .log-menu button:hover{background:#f9fafb}

  .footer{margin-top:auto;padding:12px 16px;border-top:1px solid var(--line);display:flex;align-items:center;gap:8px;position:relative}
  .account{position:relative;display:inline-block}
  .email{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;background:var(--chip);}
  .email-dot{display:inline-block;width:8px;height:8px;border-radius:50%;background:#6366f1}
  .account-menu{position:absolute;bottom:calc(100% + 6px);left:0;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);min-width:200px;overflow:hidden;opacity:0;pointer-events:none;transform:translateY(8px);transition:opacity .18s ease, transform .18s ease;z-index:35;}
  .account:hover .account-menu,.account:focus-within .account-menu,.account-menu.open{opacity:1;pointer-events:auto;transform:translateY(0)}
  .account::after{content:"";position:absolute;left:0;bottom:100%;width:230px;height:12px;}
  .menu-item{display:block;padding:12px 14px}
  .menu-item:hover{background:#f9fafb}
  .menu-danger{color:#b91c1c}

  .toolbar{display:flex;gap:12px;align-items:center;padding:14px;border-bottom:1px solid var(--line);background:#fff;position:sticky;top:0;z-index:10}
  .pill{border:1px solid var(--line);border-radius:12px;padding:10px 14px;background:#fff}
  .menu-toggle{font-weight:700}
  .dropdown{position:relative}
  .dropdown-btn{display:flex;align-items:center;gap:10px}
  .dropdown-list{position:absolute;top:52px;left:0;background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);min-width:220px;overflow:hidden;display:none;z-index:20}
  .dropdown.open .dropdown-list{display:block}
  .dropdown-item{padding:14px;font-weight:600}
  .dropdown-item:hover{background:#f9fafb}
  .hovercard{position:absolute;top:52px;left:230px;width:360px;background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);padding:16px;display:none;z-index:19}
  .hovercard h4{margin:0 0 6px 0}
  .hovercard p{margin:6px 0;color:var(--muted)}
  .hovercard ul{margin:8px 0 0 18px}
  .hovercard li{margin:4px 0}

  .home{display:flex;align-items:center;justify-content:center;flex:1;background:#fff}
  .hero{max-width:900px;text-align:center;padding:40px}
  .hero h2{font-size:44px;margin:0 0 14px 0}
  .hero em{font-style:normal;color:var(--accent);font-weight:900}
  .hero p{color:var(--muted);margin:4px 0 26px 0}
  .search{display:flex;background:#fff;border:1px solid var(--line);border-radius:999px;box-shadow:var(--shadow);max-width:560px;margin:0 auto;overflow:hidden}
  .search input{width:100%;padding:16px 20px;border:0;font-size:16px;outline:none}

  .chat{flex:1;display:none;background:#fff}
  .chat.active{display:block}
  .chat-body{height:calc(100vh - 64px - 68px);overflow:auto;padding:20px}
  .msg{max-width:620px;padding:14px 16px;background:var(--bubble);border-radius:18px}
  .msg.me{background:#fff;border:1px solid var(--line)}
  .composer{border-top:1px solid var(--line);padding:10px;background:#fff}
  .composer .input{width:100%;border:1px solid var(--line);border-radius:999px;padding:14px 18px}

  @media (max-width: 980px){body{--ml:0}}

  /* ===== Withdraw Modal ===== */
  .modal-backdrop{
    position:fixed;inset:0;background:rgba(0,0,0,.35);
    display:none;align-items:center;justify-content:center;z-index:100;
  }
  .modal-backdrop.show{display:flex;}
  .modal{
    width:min(920px,92vw);max-height:92vh;overflow:auto;
    background:#fff;border-radius:24px;box-shadow:var(--shadow);
    padding:48px 40px 36px;border:1px solid var(--line);
  }
  .modal h2{margin:0 0 18px 0;font-size:36px;line-height:1.2}
  .modal p{color:#6b7280;font-size:18px;margin:4px 0 18px}
  .modal ul{margin:8px 0 22px 26px}
  .modal li{font-size:22px;line-height:1.8;color:#6b7280}
  .modal strong{color:#111}
  .modal mark{
    background:#f4fdb0;padding:0 .25em;border-radius:.35em;
  }
  .modal .cta{
    display:block;width:100%;text-align:center;
    padding:26px 20px;border-radius:24px;
    background:#ecf39e;font-weight:800;font-size:36px;
  }
  .modal .cta:hover{filter:brightness(.98)}
  .modal .close-x{
    position:absolute;top:14px;right:18px;font-size:24px;opacity:.6;
  }
  .modal .center{display:flex;justify-content:center;margin-top:18px;color:#6b7280}
  .hidden{display:none}
</style>
</head>
<body class="sidebar-open">
<div class="app">
  <aside class="sidebar">
    <div class="brand">
      <a class="logo-link" href="#" id="logoBtn"><h1>Room Mate</h1></a>
      <button class="new-chat" id="newChatBtn"><span class="plus">＋</span> 새 채팅</button>
    </div>

    <div class="logs">
      <h2>채팅로그</h2>
      <div id="logList"></div>
    </div>

    <div class="footer">
      <div class="account" id="accountWrap">
        <div class="email" id="emailArea" tabindex="0">
          <span class="email-dot"></span><span id="emailText">Email@gmail.com</span>
        </div>
        <div class="account-menu" id="accountMenu">
          <a class="menu-item" href="intro.html">로그아웃</a>
          <a class="menu-item" href="password_modify.html">비밀번호 수정</a>
          <button class="menu-item menu-danger" id="openWithdraw">회원탈퇴</button>
        </div>
      </div>
    </div>
  </aside>

  <main class="main">
    <div class="toolbar">
      <button class="pill menu-toggle" id="menuToggle">☰</button>
      <div class="dropdown" id="categoryDropdown" data-current="청년톡">
        <button class="pill dropdown-btn" id="dropdownBtn"><span id="currentCategory">청년톡</span> ▾</button>
        <div class="dropdown-list" id="dropdownList">
          <div class="dropdown-item" data-cat="청년톡">청년톡</div>
          <div class="dropdown-item" data-cat="신혼부부톡 (I)">신혼부부톡 (I)</div>
          <div class="dropdown-item" data-cat="신혼부부톡 (II)">신혼부부톡 (II)</div>
        </div>
        <div class="hovercard" id="hoverCard"></div>
      </div>
    </div>

    <section class="home" id="homeView">
      <div class="hero">
        <h2>내 집 마련의 첫걸음, <em>Room Mate</em>가 함께합니다</h2>
        <p>청약부터 대출까지, 주거 고민은 Room Mate에게 맡겨보세요.</p>
        <form class="search" id="homeSearch" autocomplete="off">
          <input id="homeInput" type="text" placeholder="질문을 입력하세요" />
        </form>
      </div>
    </section>

    <section class="chat" id="chatView">
      <div class="chat-body" id="chatBody"></div>
      <div class="composer">
        <input class="input" id="composerInput" type="text" placeholder="질문을 입력하세요" />
      </div>
    </section>
  </main>
</div>

<!-- ===== Withdraw Modal ===== -->
<div class="modal-backdrop" id="withdrawBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="withdrawTitle">
    <button class="close-x" id="closeWithdraw" aria-label="닫기">✕</button>
    <div id="withdrawBox">
      <h2 id="withdrawTitle">지금까지 Room mate 서비스를 이용해 주셔서 정말 감사 드립니다.</h2>
      <p>더욱 개선된 서비스로 청년들에게 도움이 될 수 있도록 하겠습니다. 탈퇴하기 전 아래 유의사항을 확인해주세요.</p>
      <ul>
        <li>탈퇴하신 아이디는 <strong>복구가 불가능</strong>합니다</li>
        <li>해당 사용자의 이메일 주소, 비밀번호와 지금까지 기록된 채팅 내역들이 삭제되며, <mark>삭제된 데이터는 복구되지 않습니다</mark></li>
      </ul>
      <button class="cta" id="confirmWithdraw">확인 및 탈퇴하기</button>
      <div class="center">계정 삭제가 완료되면 시작 화면으로 이동합니다.</div>
    </div>
  </div>
</div>

<script>
/* ===== Utilities ===== */
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>[...r.querySelectorAll(s)];
const fmtTime=(d=new Date())=>d.toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'});
const state={category:"청년톡",logs:[],conversations:{},activeId:null};

/* ===== Logs & Chat Rendering (existing) ===== */
function renderLogs(){
  const wrap=$("#logList");
  wrap.innerHTML="";
  if(state.logs.length===0){return;}
  state.logs.forEach(log=>{
    const el=document.createElement("div");
    el.className="log"+(state.activeId===log.id?" active":"");
    el.dataset.id=log.id;
    el.innerHTML=`
      <div class="log-main">
        <div style="font-weight:700">${log.title}</div>
        <small>${log.ts}</small>
      </div>
      <div class="log-actions" data-stop>
        <button class="kebab" data-kebab>⋯</button>
        <div class="log-menu"><button data-delete>삭제</button></div>
      </div>`;
    el.addEventListener("click",e=>{
      if(e.target.closest("[data-stop]"))return;
      openConversation(log.id);
    });
    wrap.appendChild(el);
  });
}
function renderConversation(id){
  const conv=state.conversations[id]||[];
  const chatBody=$("#chatBody");
  chatBody.innerHTML="";
  conv.forEach(m=>{
    const d=document.createElement("div");
    d.className="msg"+(m.role==='me'?" me":"");
    d.textContent=m.text;
    d.style.marginTop="14px";
    chatBody.appendChild(d);
  });
  chatBody.scrollTop=chatBody.scrollHeight;
}
function goHome(){ $("#homeView").style.display="flex"; $("#chatView").classList.remove("active"); state.activeId=null; renderLogs(); }
function openChat(id){ $("#homeView").style.display="none"; $("#chatView").classList.add("active"); state.activeId=id; renderLogs(); renderConversation(id); $("#composerInput").focus(); }
function startNewChat(initialText=""){ const id=crypto.randomUUID(); const title=`새 채팅 · ${state.category}`; state.logs.unshift({id,title,ts:fmtTime()}); state.conversations[id]=[]; if(initialText)state.conversations[id].push({role:'me',text:initialText}); openChat(id); }
function openConversation(id){ if(!state.conversations[id])return; openChat(id); }
function deleteLog(id){ state.logs=state.logs.filter(l=>l.id!==id); delete state.conversations[id]; if(state.activeId===id){goHome();} renderLogs(); }

/* ===== Top bar / dropdown (existing) ===== */
$("#menuToggle").addEventListener("click",()=>document.body.classList.toggle("sidebar-closed"));
$("#logoBtn").addEventListener("click",e=>{e.preventDefault();goHome();});
$("#newChatBtn").addEventListener("click",()=>startNewChat(""));
$("#homeSearch").addEventListener("submit",e=>{e.preventDefault();const t=$("#homeInput").value.trim();startNewChat(t);});
const dropdown=$("#categoryDropdown"),dropdownBtn=$("#dropdownBtn"),dropdownList=$("#dropdownList"),hoverCard=$("#hoverCard");
dropdownBtn.addEventListener("click",()=>{dropdown.classList.toggle("open");});
$$(".dropdown-item",dropdownList).forEach(i=>i.addEventListener("click",()=>{$("#currentCategory").textContent=i.dataset.cat;dropdown.classList.remove("open","show-card");}));

/* ===== Account menu (existing) ===== */
const accountWrap=$("#accountWrap"),emailArea=$("#emailArea"),accountMenu=$("#accountMenu");
emailArea.addEventListener("click",e=>{e.stopPropagation();accountMenu.classList.toggle("open");});
document.addEventListener("click",e=>{if(!accountWrap.contains(e.target))accountMenu.classList.remove("open");});

/* ===== Composer (existing) ===== */
const composer=$("#composerInput");
composer.addEventListener("keydown",e=>{
  if(e.key!=="Enter")return;
  e.preventDefault();
  const v=composer.value.trim();
  if(!v||!state.activeId)return;
  state.conversations[state.activeId].push({role:'me',text:v});
  composer.value="";
  renderConversation(state.activeId);
});

/* ===== Log kebab (existing) ===== */
const logList=$("#logList");
logList.addEventListener("click",e=>{
  const kebab=e.target.closest("[data-kebab]");
  const item=e.target.closest(".log");
  if(kebab&&item){e.stopPropagation();item.classList.toggle("open");}
  const delBtn=e.target.closest("[data-delete]");
  if(delBtn&&item){deleteLog(item.dataset.id);}
});

/* ===== Withdraw Modal (new) ===== */
const openWithdrawBtn = $("#openWithdraw");
const backdrop = $("#withdrawBackdrop");
const closeWithdrawBtn = $("#closeWithdraw");
const confirmWithdrawBtn = $("#confirmWithdraw");
const withdrawBox = $("#withdrawBox");

function openWithdrawModal(){
  backdrop.classList.add("show");
  backdrop.setAttribute("aria-hidden","false");
  // 포커스 이동
  confirmWithdrawBtn.focus();
}
function closeWithdrawModal(){
  backdrop.classList.remove("show");
  backdrop.setAttribute("aria-hidden","true");
}

openWithdrawBtn.addEventListener("click", (e)=>{
  e.preventDefault();
  accountMenu.classList.remove("open");
  openWithdrawModal();
});
backdrop.addEventListener("click", (e)=>{
  if(e.target===backdrop) closeWithdrawModal();
});
closeWithdrawBtn.addEventListener("click", closeWithdrawModal);
document.addEventListener("keydown",(e)=>{
  if(e.key==="Escape" && backdrop.classList.contains("show")) closeWithdrawModal();
});

confirmWithdrawBtn.addEventListener("click", ()=>{
  // 성공 문구로 전환 후 리다이렉트
  withdrawBox.innerHTML = `
    <h2 style="margin:0 0 10px 0;font-size:36px;">탈퇴가 완료되었습니다.</h2>
    <p style="color:#6b7280;font-size:18px;">잠시 후 시작 화면으로 이동합니다…</p>
  `;
  setTimeout(()=>{ window.location.href = "intro.html"; }, 1200);
});

/* ===== Boot ===== */
function boot(){
  if(window.matchMedia("(max-width:980px)").matches)document.body.classList.add("sidebar-closed");
  renderLogs();
}
boot();
</script>
</body>
</html>
