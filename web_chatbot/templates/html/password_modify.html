<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Room Mate â€“ ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì • (í†µí•©)</title>
<style>
  :root{ --line:#e5e7eb; --muted:#9ca3af; --text:#111827; --btn:#7a7a7a;
         --shadow:0 2px 10px rgba(0,0,0,.06), 0 1px 3px rgba(0,0,0,.05); }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:#fff}

  /* í—¤ë” */
  .topbar{height:56px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between;padding:0 22px}
  .logo{font-family:"Times New Roman",serif;font-style:italic;font-size:22px;color:var(--text);text-decoration:none}
  .toplink{color:var(--text);text-decoration:none;font-size:14px}

  /* ë ˆì´ì•„ì›ƒ */
  .wrap{min-height:calc(100vh - 56px);padding:6vh 16px 10vh}
  .container{width:min(820px,94vw);margin:0 auto}
  .title{text-align:center;font-size:32px;font-weight:700;margin:36px 0 24px}

  /* ë‹¨ê³„ í‘œì‹œ */
  .steps{display:flex;gap:36px;justify-content:center;align-items:center;margin:8px 0 36px}
  .step{display:flex;align-items:center;gap:12px;font-size:14px;color:#c2c9d3}
  .step.clickable{cursor:pointer}  /* â† 2ë‹¨ê³„ì— ìˆì„ ë•Œë§Œ 1ë²ˆì„ í´ë¦­ ê°€ëŠ¥ */
  .dot{width:26px;height:26px;border-radius:50%;display:grid;place-items:center;background:#f7f7f8;color:#b8bec8;border:1px solid #eceff3;font-weight:700}
  .active{color:var(--text);font-weight:700}
  .active .dot{background:#111827;color:#fff;border-color:#111827}

  /* ê³µí†µ í¼ */
  .section{width:min(680px,94vw);margin:0 auto}
  .label-strong{font-weight:700;margin:22px 0 6px}
  .help{font-size:13px;color:#777;margin:0 0 16px}
  input[type=email], input[type=text], input[type=password]{
    width:100%;padding:16px 16px;border-radius:12px;border:1px solid var(--line);background:#fafafa;font-size:15px
  }
  input:focus{outline:none;border-color:#aab4ff;box-shadow:0 0 0 3px rgba(124,140,248,.2);background:#fff}

  .row{display:grid;grid-template-columns:1fr auto;align-items:center;gap:12px;margin-bottom:28px}
  .input-wrap{position:relative}
  .actions{display:flex;justify-content:center;margin-top:8px}
  .btn{border:0;background:var(--btn);color:#fff;font-weight:600;cursor:pointer}
  .btn-slim{height:52px;padding:0 18px;border-radius:12px}
  .btn-next{width:260px;height:56px;border-radius:16px;box-shadow:var(--shadow)}
  .btn-next:disabled{opacity:.45;cursor:not-allowed}

  /* 1ë‹¨ê³„: ì½”ë“œ ì…ë ¥ ìŠ¤íƒ€ì¼ */
  #code{ text-align:center; letter-spacing:2px; font-size:18px; font-weight:500; transition:text-align .2s ease }
  #code:focus{ text-align:left }
  .timer{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#ef4444;font-size:13px}
  .resend{color:#8b8b8b;font-size:13px;margin:6px 0 28px}
  .resend a{color:#666;text-decoration:underline;cursor:pointer}

  /* 2ë‹¨ê³„: í† ê¸€ ë²„íŠ¼ */
  .toggle-btn{
    position:absolute;right:16px;top:50%;transform:translateY(-50%);
    color:#666;font-size:13px;cursor:pointer;user-select:none;display:flex;align-items:center;gap:4px;
  }
  .toggle-btn:hover{color:#333}

  .hidden{display:none}

  /* === ì™„ë£Œ ëª¨ë‹¬ === */
  .modal-backdrop{
    position:fixed;inset:0;background:rgba(0,0,0,.45);
    display:none;align-items:center;justify-content:center;z-index:1000;
  }
  .modal{
    width:min(520px,92vw);background:#fff;border-radius:20px;
    box-shadow:0 20px 60px rgba(0,0,0,.18);padding:28px 24px;text-align:center;
  }
  .modal h3{margin:6px 0 10px;font-size:22px}
  .modal p{margin:0 0 20px;color:#6b7280}
  .modal .ok-btn{
    display:inline-block;margin-top:4px;padding:12px 18px;border-radius:12px;background:#111827;color:#fff;
    text-decoration:none;cursor:pointer;font-weight:700;box-shadow:var(--shadow);
  }
  .modal-backdrop.open{display:flex}
</style>
</head>
<body>
  <header class="topbar">
    <!-- ë¡œê³  í´ë¦­ ì‹œ intro_login.html ì´ë™ -->
    <a class="logo" href="{% url 'user:index' %}">Room Mate</a>
    <!-- ë¡œê·¸ì•„ì›ƒ í´ë¦­ ì‹œ login.html ì´ë™ -->
    <a class="toplink" href="{% url 'user:logout' %}">ë¡œê·¸ì•„ì›ƒ</a>
  </header>

  <main class="wrap">
    <div class="container">
      <h1 class="title">ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •</h1>

      <!-- ë‹¨ê³„í‘œì‹œ -->
      <div class="steps">
        <div id="ind1" class="step active" title="ì´ë©”ì¼ ì¸ì¦ìœ¼ë¡œ ëŒì•„ê°€ê¸°"><span class="dot">1</span><span>ì´ë©”ì¼ ì¸ì¦</span></div>
        <div id="ind2" class="step"><span class="dot">2</span><span>ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •</span></div>
      </div>

      <!-- ===== 1ë‹¨ê³„: ì´ë©”ì¼ ì¸ì¦ ===== -->
      <section id="step1" class="section">
        <div class="label-strong">ì´ë©”ì¼ ì…ë ¥</div>
        <p class="help">íšŒì›ê°€ì…ì‹œ ì‚¬ìš©í–ˆë˜ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
        <div class="row">
          <input id="email" type="email" placeholder="ì´ë©”ì¼ (e.g. email@gmail.com)" />
          <button type="button" class="btn btn-slim" id="btnSend">ì „ì†¡</button>
        </div>

        <div id="verifyArea" style="display:none;">
          <div class="label-strong">ì´ë©”ì¼ ì¸ì¦</div>
          <p class="help">í•´ë‹¹ ì´ë©”ì¼ë¡œ ì „ì†¡ëœ ê²€ì¦ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>

          <div class="row">
            <div class="input-wrap">
              <input id="code" type="text" placeholder="XXXX - XXXX" maxlength="11" />
              <span id="timer" class="timer">3:00</span>
            </div>
            <button type="button" class="btn btn-slim" id="btnCheck">í™•ì¸</button>
          </div>

          <div class="resend">ê²€ì¦ ì½”ë“œê°€ ì˜¤ì§€ ì•Šì•˜ë‚˜ìš”? <a href="#" id="resend">ì¬ì „ì†¡</a></div>
        </div>

        <div class="actions">
          <button class="btn btn-next" id="toStep2" disabled>ë‹¤ìŒ</button>
        </div>
      </section>

      <!-- ===== 2ë‹¨ê³„: ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì • ===== -->
      <section id="step2" class="section hidden">
        <div class="label-strong">ë¹„ë°€ë²ˆí˜¸ (8~16ì, ì˜ë¬¸ ëŒ€ì†Œë¬¸ì / ìˆ«ì / íŠ¹ìˆ˜ë¬¸ì í¬í•¨)</div>
        <div class="input-wrap">
          <input id="pw" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
          <span class="toggle-btn" data-target="pw">ğŸ‘ Hide</span>
        </div>

        <div class="label-strong">ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥</div>
        <div class="input-wrap">
          <input id="pw2" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”" />
          <span class="toggle-btn" data-target="pw2">ğŸ‘ Hide</span>
        </div>

        <div class="actions">
          <button class="btn btn-next" id="finish">ë‹¤ìŒ</button>
        </div>
      </section>
    </div>
  </main>

  <!-- === ì™„ë£Œ ëª¨ë‹¬ === -->
  <div id="doneModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="doneTitle">
    <div class="modal" id="modalCard">
      <h3 id="doneTitle">ë¹„ë°€ë²ˆí˜¸ê°€ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤</h3>
      <p>í™•ì¸ì„ í´ë¦­í•˜ë©´ ì±„íŒ… í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
      <span class="ok-btn" id="goChatBtn">í™•ì¸</span>
    </div>
  </div>

<script>
/* ===== 1ë‹¨ê³„: ì´ë©”ì¼ ì¸ì¦ ===== */
let timerInterval; let remaining=0; let verified=false;

const emailEl = document.getElementById('email');
const codeEl  = document.getElementById('code');
const timerEl = document.getElementById('timer');
const btnSend = document.getElementById('btnSend');
const btnCheck= document.getElementById('btnCheck');
const btnNext = document.getElementById('toStep2');
const resend  = document.getElementById('resend');
const verifyArea = document.getElementById('verifyArea');

function formatTime(sec){const m=Math.floor(sec/60);const s=String(sec%60).padStart(2,'0');return `${m}:${s}`;}
function startTimer(d=180){
  clearInterval(timerInterval); remaining=d;
  timerEl.textContent=formatTime(remaining); timerEl.style.color='#ef4444';
  timerInterval=setInterval(()=>{
    remaining--; timerEl.textContent=formatTime(Math.max(remaining,0));
    if(remaining<=0){ clearInterval(timerInterval); timerEl.textContent='ë§Œë£Œ'; timerEl.style.color='#999'; verified=false; btnNext.disabled=true; }
  },1000);
}

btnSend.addEventListener('click', ()=>{
  const email=emailEl.value.trim();
  if(!email){ alert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  verifyArea.style.display='block';
  startTimer();
  alert('ì¸ì¦ì½”ë“œê°€ '+email+' ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
  codeEl.value=''; codeEl.focus();
});

resend.addEventListener('click', (e)=>{
  e.preventDefault();
  if(remaining>0){ alert('ì•„ì§ ì‹œê°„ì´ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ('+formatTime(remaining)+')'); return; }
  startTimer(); alert('ì¸ì¦ì½”ë“œë¥¼ ì¬ì „ì†¡í–ˆìŠµë‹ˆë‹¤.');
  codeEl.value=''; codeEl.focus();
});

codeEl.addEventListener('input', (e)=>{
  let v=e.target.value.replace(/\D/g,'').slice(0,8);
  if(v.length>4) v=v.slice(0,4)+' - '+v.slice(4);
  e.target.value=v;
});

btnCheck.addEventListener('click', ()=>{
  if(remaining<=0){ alert('ì‹œê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì¬ì „ì†¡ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); return; }
  const digits=codeEl.value.replace(/\D/g,'');
  if(digits.length!==8){ alert('8ìë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  verified=true; alert('ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
  btnNext.disabled=false;
});

/* ===== ë‹¨ê³„ ì „í™˜ ===== */
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const ind1 = document.getElementById('ind1');
const ind2 = document.getElementById('ind2');

function goToStep2(){
  if(!verified){ alert('ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•˜ì„¸ìš”.'); return; }
  step1.classList.add('hidden');
  step2.classList.remove('hidden');
  ind1.classList.remove('active');
  ind2.classList.add('active');

  // 2ë‹¨ê³„ì— ìˆì„ ë•Œë§Œ 1ë²ˆ ì¸ë””ì¼€ì´í„°ë¥¼ í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡
  ind1.classList.add('clickable');
  document.getElementById('pw').focus();
}

function goToStep1(){
  step2.classList.add('hidden');
  step1.classList.remove('hidden');
  ind2.classList.remove('active');
  ind1.classList.add('active');

  // 1ë‹¨ê³„ë¡œ ëŒì•„ì˜¤ë©´ í´ë¦­ ë¹„í™œì„±í™”(ì˜ë¯¸ìƒ)
  ind1.classList.remove('clickable');
}

btnNext.addEventListener('click', goToStep2);

/* 2 â†’ 1: 1ë²ˆ ì¸ë””ì¼€ì´í„° í´ë¦­ìœ¼ë¡œë§Œ ì´ë™(ì…ë ¥ ê°’ ìœ ì§€) */
ind1.addEventListener('click', ()=>{
  if(ind1.classList.contains('clickable')){ goToStep1(); }
});

/* ===== 2ë‹¨ê³„: ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì • ===== */
function togglePw(id, el){
  const input=document.getElementById(id);
  if(input.type==='password'){ input.type='text'; el.textContent='Show'; }
  else { input.type='password'; el.textContent='ğŸ‘ Hide'; }
  input.focus(); const v=input.value; input.value=''; input.value=v;
}

document.querySelectorAll('.toggle-btn').forEach(el=>{
  el.addEventListener('click', ()=>togglePw(el.dataset.target, el));
});

/* ì™„ë£Œ ëª¨ë‹¬ ì œì–´ */
const doneModal = document.getElementById('doneModal');
const modalCard = document.getElementById('modalCard');
const goChatBtn = document.getElementById('goChatBtn');
function openModal(){ doneModal.classList.add('open'); }
function closeAndGo(){ window.location.href='chat.html'; }

goChatBtn.addEventListener('click', closeAndGo);
/* ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œì—ë„ ì´ë™ */
doneModal.addEventListener('click', closeAndGo);
/* ëª¨ë‹¬ ì¹´ë“œ ë‚´ë¶€ í´ë¦­ì€ ë²„ë¸”ë§ ë§‰ê¸° */
modalCard.addEventListener('click', e=>e.stopPropagation());

document.getElementById('finish').addEventListener('click', ()=>{
  const pw  = document.getElementById('pw').value.trim();
  const pw2 = document.getElementById('pw2').value.trim();

  if(!pw || !pw2){ alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  if(pw.length < 8 || pw.length > 16){ alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 8~16ìì—¬ì•¼ í•©ë‹ˆë‹¤.'); return; }

  const hasSpecial = /[!@#$%^&*(),.?":{}|<>_\-+=~`[\]\\;]/.test(pw);
  if(!hasSpecial){ alert('ë¹„ë°€ë²ˆí˜¸ì—ëŠ” ë°˜ë“œì‹œ íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.'); return; }

  if(pw !== pw2){ alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }

  // ì„œë²„ ì—°ë™ ìœ„ì¹˜: ì‹¤ì œ ë³€ê²½ API ì„±ê³µ í›„ ëª¨ë‹¬ í‘œì‹œ
  openModal();
});
</script>
</body>
</html>
