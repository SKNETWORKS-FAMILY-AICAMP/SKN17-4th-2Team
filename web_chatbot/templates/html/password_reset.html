<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Room Mate – 비밀번호 재설정 (통합)</title>
<style>
  :root{ --line:#e5e7eb; --muted:#9ca3af; --text:#111827; --btn:#7a7a7a;
         --link:#6c79ff; --ok:#10b981; --warn:#ef4444;
         --shadow:0 2px 10px rgba(0,0,0,.06), 0 1px 3px rgba(0,0,0,.05); }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:#fff}

  /* 헤더 */
  .topbar{height:56px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between;padding:0 22px}
  .logo{font-family:"Times New Roman",serif;font-style:italic;font-size:22px;color:inherit;text-decoration:none}
  .toplink{color:var(--text);text-decoration:none;font-size:14px}

  /* 공통 레이아웃 */
  .wrap{min-height:calc(100vh - 56px);padding:6vh 16px 10vh}
  .container{width:min(820px,94vw);margin:0 auto}
  .title{text-align:center;font-size:34px;font-weight:700;margin:36px 0 24px}

  /* 단계 표시 */
  .steps{display:flex;gap:36px;justify-content:center;align-items:center;margin:8px 0 36px}
  .step{display:flex;align-items:center;gap:12px;font-size:14px;color:#c2c9d3}
  .dot{width:26px;height:26px;border-radius:50%;display:grid;place-items:center;background:#f7f7f8;color:#b8bec8;border:1px solid #eceff3;font-weight:700}
  .active{color:var(--text);font-weight:700}
  .active .dot{background:#111827;color:#fff;border-color:#111827}

  /* 1단계 */
  .section{width:min(680px,94vw);margin:0 auto}
  .label-strong{font-weight:700;margin:22px 0 6px}
  .help{font-size:13px;color:#777;margin:0 0 16px}

  input[type=email], input[type=text], input[type=password]{
    width:100%;padding:16px 16px;border-radius:12px;border:1px solid var(--line);background:#fafafa;font-size:15px
  }
  input:focus{outline:none;border-color:#aab4ff;box-shadow:0 0 0 3px rgba(124,140,248,.2);background:#fff}

  #code{ text-align:center; letter-spacing:2px; font-size:18px; font-weight:500; transition:text-align .2s ease }
  #code:focus{ text-align:left }

  .btn{border:0;background:var(--btn);color:#fff;font-weight:600;cursor:pointer}
  .btn-send,.btn-check{height:52px;padding:0 18px;border-radius:12px}

  .row{display:grid;grid-template-columns:1fr auto;align-items:center;gap:12px;margin-bottom:28px}
  .input-wrap{position:relative}
  .timer{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#ef4444;font-size:13px}

  .resend{color:#8b8b8b;font-size:13px;margin:6px 0 28px}
  .resend a{color:#666;text-decoration:underline;cursor:pointer}

  /* 2단계 */
  .input-wrap.toggle{margin-bottom:26px}
  .toggle-btn{
    position:absolute;right:16px;top:50%;transform:translateY(-50%);
    color:#666;font-size:13px;cursor:pointer;user-select:none;display:flex;align-items:center;gap:4px;
  }
  .toggle-btn:hover{color:#333}
  .msg{font-size:13px;margin-top:6px}
  .msg.ok{color:var(--ok)}
  .msg.warn{color:var(--warn)}

  /* 하단 버튼 */
  .actions{display:flex;justify-content:center;margin-top:28px}
  .btn-next{width:260px;height:56px;border-radius:16px;box-shadow:var(--shadow)}
  .btn-next:disabled{opacity:.45;cursor:not-allowed}

  .hidden{display:none}
</style>
</head>
<body>
  <header class="topbar">
    <!-- 수정: 로고 클릭 시 intro.html 이동 -->
    <a class="logo" href="intro.html" aria-label="Room Mate 홈으로">Room Mate</a>
    <a class="toplink" href="login.html">로그인</a>
  </header>

  <main class="wrap">
    <div class="container">
      <h1 class="title">비밀번호 재설정</h1>

      <div class="steps" aria-label="비밀번호 재설정 단계">
        <div class="step active" id="s1Ind"><span class="dot">1</span><span>이메일 인증</span></div>
        <div class="step" id="s2Ind"><span class="dot">2</span><span>비밀번호 재설정</span></div>
      </div>

      <!-- 1단계 -->
      <section id="step1" class="section">
        <div class="label-strong">이메일 입력</div>
        <p class="help">회원가입시 사용했던 이메일을 입력해주세요</p>

        <div class="row">
          <input id="email" type="email" placeholder="이메일 (e.g. Email@gmail.com)" />
          <button type="button" class="btn btn-send" id="btnSend">전송</button>
        </div>

        <div id="verifyArea" style="display:none;">
          <div class="label-strong">이메일 인증</div>
          <p class="help">해당 이메일로 전송된 검증 코드를 입력해주세요</p>

          <div class="row">
            <div class="input-wrap">
              <input id="code" type="text" placeholder="XXXX - XXXX" maxlength="11" />
              <span id="timer" class="timer">3:00</span>
            </div>
            <button type="button" class="btn btn-check" id="btnCheck">확인</button>
          </div>

          <div class="resend">검증 코드가 오지 않았나요? <a href="#" id="resend">재전송</a></div>
        </div>

        <div class="actions">
          <button class="btn btn-next" id="toStep2" disabled>다음</button>
        </div>
      </section>

      <!-- 2단계 -->
      <section id="step2" class="section hidden">
        <div class="label-strong">비밀번호 (8~16자, 영문 대소문자 / 숫자 / 특수문자 포함)</div>
        <div class="input-wrap toggle">
          <input id="pw" type="password" placeholder="새 비밀번호를 입력하세요" />
          <span class="toggle-btn" data-target="pw">👁 Hide</span>
        </div>

        <div class="label-strong">비밀번호 재입력</div>
        <div class="input-wrap toggle">
          <input id="pw2" type="password" placeholder="비밀번호를 다시 입력하세요" />
          <span class="toggle-btn" data-target="pw2">👁 Hide</span>
        </div>

        <div id="pwMsg" class="msg"></div>
        <div id="matchMsg" class="msg"></div>

        <div class="actions">
          <button class="btn btn-next" id="finish" disabled>다음</button>
        </div>
      </section>
    </div>
  </main>

<script>
/* 기존 기능 그대로 유지 */
let timerInterval; let remaining=0; let verified=false;

const emailEl = document.getElementById('email');
const codeEl  = document.getElementById('code');
const timerEl = document.getElementById('timer');
const btnSend = document.getElementById('btnSend');
const btnCheck= document.getElementById('btnCheck');
const btnNext = document.getElementById('toStep2');
const resend  = document.getElementById('resend');
const verifyArea = document.getElementById('verifyArea');

function formatTime(sec){const m=Math.floor(sec/60);const s=String(sec%60).padStart(2,'0');return `${m}:${s}`;}
function startTimer(d=180){
  clearInterval(timerInterval); remaining=d;
  timerEl.textContent=formatTime(remaining); timerEl.style.color='#ef4444';
  timerInterval=setInterval(()=>{
    remaining--; timerEl.textContent=formatTime(Math.max(remaining,0));
    if(remaining<=0){ clearInterval(timerInterval); timerEl.textContent='만료'; timerEl.style.color='#999'; verified=false; btnNext.disabled=true; }
  },1000);
}

btnSend.addEventListener('click', ()=>{
  const email=emailEl.value.trim();
  if(!email){ alert('이메일을 입력해주세요.'); return; }
  verifyArea.style.display='block';
  startTimer();
  alert('인증코드가 '+email+' 로 전송되었습니다.');
  codeEl.value=''; codeEl.focus();
});

resend.addEventListener('click', (e)=>{
  e.preventDefault();
  if(remaining>0){ alert('아직 시간이 남았습니다. ('+formatTime(remaining)+')'); return; }
  startTimer(); alert('인증코드를 재전송했습니다.');
  codeEl.value=''; codeEl.focus();
});

codeEl.addEventListener('input', (e)=>{
  let v=e.target.value.replace(/\D/g,'').slice(0,8);
  if(v.length>4) v=v.slice(0,4)+' - '+v.slice(4);
  e.target.value=v;
});

btnCheck.addEventListener('click', ()=>{
  if(remaining<=0){ alert('시간이 만료되었습니다. 재전송 후 다시 시도해주세요.'); return; }
  const digits=codeEl.value.replace(/\D/g,'');
  if(digits.length!==8){ alert('8자리 코드를 입력하세요.'); return; }
  verified=true; alert('인증 완료!');
  btnNext.disabled=false;
});

const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const s1Ind = document.getElementById('s1Ind');
const s2Ind = document.getElementById('s2Ind');

btnNext.addEventListener('click', ()=>{
  if(!verified){ alert('이메일 인증을 완료하세요.'); return; }
  step1.classList.add('hidden');
  step2.classList.remove('hidden');
  s1Ind.classList.remove('active');
  s2Ind.classList.add('active');
  document.getElementById('pw').focus();
});

const pw = document.getElementById('pw');
const pw2 = document.getElementById('pw2');
const finishBtn = document.getElementById('finish');
const pwMsg = document.getElementById('pwMsg');
const matchMsg = document.getElementById('matchMsg');

const reLen=/^.{8,16}$/; const reUpper=/[A-Z]/; const reLower=/[a-z]/; const reNum=/[0-9]/; const reSpec=/[^A-Za-z0-9]/;
function validPassword(v){ return reLen.test(v)&&reUpper.test(v)&&reLower.test(v)&&reNum.test(v)&&reSpec.test(v); }

function renderPw(){
  const v1=pw.value, v2=pw2.value;
  if(!v1){ pwMsg.textContent=''; pwMsg.className='msg'; }
  else if(validPassword(v1)){ pwMsg.textContent='사용 가능한 비밀번호입니다.'; pwMsg.className='msg ok'; }
  else { pwMsg.textContent='8~16자, 대/소문자·숫자·특수문자 각각 1개 이상 포함해야 합니다.'; pwMsg.className='msg warn'; }

  if(!v2){ matchMsg.textContent=''; matchMsg.className='msg'; }
  else if(v1===v2){ matchMsg.textContent='비밀번호가 일치합니다.'; matchMsg.className='msg ok'; }
  else { matchMsg.textContent='비밀번호가 일치하지 않습니다.'; matchMsg.className='msg warn'; }

  finishBtn.disabled = !(validPassword(v1) && v1===v2);
}
pw.addEventListener('input', renderPw);
pw2.addEventListener('input', renderPw);

document.querySelectorAll('.toggle-btn').forEach(el=>{
  el.addEventListener('click', ()=>{
    const target=document.getElementById(el.dataset.target);
    if(target.type==='password'){ target.type='text'; el.textContent='Show'; }
    else { target.type='password'; el.textContent='👁 Hide'; }
    target.focus(); const val=target.value; target.value=''; target.value=val;
  });
});

finishBtn.addEventListener('click', ()=>{
  alert('비밀번호가 재설정되었습니다!');
  location.href='login.html';
});
</script>
</body>
</html>
