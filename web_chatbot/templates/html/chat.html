<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Room Mate â€“ ì±„íŒ… & ì„¸ì…˜ ë¡œê·¸</title>
<style>
  :root{ --sidebar-w:300px; --line:#e5e7eb; --muted:#6b7280; --bubble:#f5f6f8; --user:#fff; }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#111}

  /* ===== ì‚¬ì´ë“œë°” ===== */
  .sidebar{
    position:fixed;inset:0 auto 0 0;width:var(--sidebar-w);
    background:#f9fafb;border-right:1px solid var(--line);
    transform:translateX(calc(-1 * var(--sidebar-w)));transition:transform .35s ease;z-index:20;
    display:flex;flex-direction:column;justify-content:space-between;
  }
  body.sidebar-open .sidebar{transform:translateX(0)}
  .sidebar-header{padding:16px 18px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:10px}
  .brand{font-family:"Times New Roman",serif;font-weight:700;font-size:22px;margin-right:auto;cursor:pointer}
  .brand:active{transform:translateY(1px)}
  .new-chat{
    font-size:14px;border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer
  }
  .sidebar-body{padding:8px 8px 14px;overflow-y:auto;flex:1}
  .chat-item{
    position:relative;
    display:flex;align-items:center;gap:8px;
    padding:10px 10px;border-radius:10px;cursor:pointer;
  }
  .chat-item:hover{background:#f3f4f6}
  .chat-main{min-width:0;flex:1;display:flex;flex-direction:column;gap:2px}
  .chat-title{font-size:14px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .chat-snippet{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

  /* â‹¯ ë²„íŠ¼ + ë©”ë‰´ */
  .more-wrap{position:relative}
  .more-btn{
    opacity:0; transition:opacity .15s ease;
    border:1px solid var(--line); background:#fff; border-radius:8px;
    padding:6px 8px; font-size:16px; line-height:1; cursor:pointer; user-select:none;
  }
  .chat-item:hover .more-btn{opacity:1}
  .more-menu{
    position:absolute; right:0; top:36px; min-width:140px;
    background:#fff; border:1px solid var(--line); border-radius:10px;
    box-shadow:0 10px 28px rgba(0,0,0,.12); padding:6px; display:none; z-index:60;
  }
  .more-menu.open{display:block}
  .mm-item{padding:10px 12px; border-radius:8px; font-size:14px}
  .mm-item:hover{background:#f5f6f8}
  .mm-danger{color:#b91c1c}

  /* ì´ë©”ì¼ footer + íŒì˜¤ë²„ */
  .sidebar-footer{position:relative;border-top:1px solid var(--line);padding:12px 14px;font-size:13px;color:var(--muted);display:flex;align-items:center;gap:8px;cursor:pointer}
  .sidebar-footer .mail{font-size:14px;color:#111}
  .sidebar-footer:hover{background:#f3f4f6}
  .account-menu{position:absolute;left:10px;bottom:48px;min-width:180px;background:#fff;border:1px solid var(--line);border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.08);padding:6px;display:none;z-index:50}
  .account-menu.open{display:block}
  .account-item{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:8px;color:#111;text-decoration:none}
  .account-item:hover{background:#f3f4f6}
  .account-item.danger{color:#b91c1c}

  /* ì˜¤ë²„ë ˆì´ + â˜° ë²„íŠ¼ */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.05);opacity:0;pointer-events:none;transition:opacity .25s ease;z-index:15}
  body.sidebar-open .overlay{opacity:1;pointer-events:auto}
  .toggle-btn{position:fixed;top:14px;left:14px;z-index:30;width:42px;height:42px;border:1px solid var(--line);border-radius:10px;background:#fff;display:grid;place-items:center;cursor:pointer;user-select:none;box-shadow:0 1px 6px rgba(0,0,0,.06);transition:transform .35s ease}
  body.sidebar-open .toggle-btn{transform:translateX(var(--sidebar-w))}

  /* ===== ì¹´í…Œê³ ë¦¬ ì„ íƒ ë°•ìŠ¤ ===== */
  .topic{ position:fixed; top:14px; left:66px; z-index:30; transition:transform .35s ease; }
  body.sidebar-open .topic{ transform:translateX(var(--sidebar-w)); }
  .topic-btn{
    min-width:120px; height:42px; padding:0 12px; border:1px solid var(--line); border-radius:10px;
    background:#fff; display:flex; align-items:center; gap:8px; cursor:pointer; box-shadow:0 1px 6px rgba(0,0,0,.06);
    font-size:15px;
  }
  .chev{ font-size:16px; color:#888; margin-left:auto }
  .topic-panel{
    position:absolute; top:48px; left:0; width:320px; max-width:92vw;
    border:1px solid var(--line); border-radius:12px; background:#fff; box-shadow:0 10px 28px rgba(0,0,0,.12);
    padding:8px; display:none;
  }
  .topic-panel.open{ display:block; }
  .topic-item{ padding:12px; border-radius:10px; cursor:pointer; position:relative; }
  .topic-item:hover{ background:#f5f6f8; }

  .topic-item:hover::after {
    content: attr(data-tooltip);
    white-space: pre-wrap;
    position: absolute;
    top: 110%;
    left: 0;
    background: #f9fafb;
    color: #111;
    border: 1px solid #e5e7eb;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    padding: 12px 16px;
    border-radius: 12px;
    font-size: 13px;
    line-height: 1.6;
    z-index: 200;
    width: max-content;
    max-width: 320px;
    animation: fadeInTooltip 0.2s ease-out forwards;
  }

  @keyframes fadeInTooltip {
    0% { opacity: 0; transform: translateY(6px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  .topic-title{ font-size:18px; font-weight:800; letter-spacing:-.02em; margin:0 0 4px }
  .topic-sub{ font-size:13px; color:#777; margin:0 }
  .topic-item small{ color:#999; font-weight:700; margin-left:6px }

  /* ===== í™”ë©´ ì „í™˜ ê³µí†µ ===== */
  .screen{opacity:1;transform:translateY(0);transition:opacity .35s ease, transform .35s ease}
  .screen.hidden{opacity:0;transform:translateY(10px);pointer-events:none;position:absolute;inset:0}

  /* ===== ì¸íŠ¸ë¡œ(ì²« í™”ë©´) ===== */
  .main-wrap{min-height:100vh;display:grid;place-items:center;padding:40px 16px;transition:transform .35s ease}
  body.sidebar-open .main-wrap{transform:translateX(var(--sidebar-w))}
  .center{text-align:center}
  .headline{font-size:34px;margin:0 0 12px;font-weight:700;letter-spacing:-.02em}
  .rm-italic{font-family:"Times New Roman",Georgia,serif;font-style:italic;font-weight:600}
  .sub{color:var(--muted);margin-bottom:22px}
  .search{width:min(720px,92vw);border:1px solid var(--line);border-radius:20px;padding:14px 16px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
  .search input{width:100%;border:0;outline:0;font-size:15px;background:transparent}

  /* ===== ì±„íŒ… í™”ë©´ ===== */
  .chat-wrap{display:flex;flex-direction:column;min-height:100vh;padding:60px 16px 24px 16px;transition:transform .35s ease}
  body.sidebar-open .chat-wrap{transform:translateX(var(--sidebar-w))}
  .chat-area{flex:1;border:1px solid var(--line);border-radius:16px;padding:16px;overflow-y:auto;background:#fff}
  .row{display:flex;margin:6px 0}
  .row.user{justify-content:flex-end}
  .msg{max-width:78%;padding:10px 14px;border-radius:16px;font-size:14px;line-height:1.55;white-space:pre-wrap;word-break:break-word}
  .row.user .msg{background:var(--user);border:1px solid var(--line);border-bottom-right-radius:6px}
  .row.bot  .msg{background:var(--bubble);border-bottom-left-radius:6px}
  .composer{display:flex;gap:10px;margin-top:12px}
  .composer input{flex:1;border:1px solid var(--line);border-radius:18px;padding:14px 16px;box-shadow:0 2px 8px rgba(0,0,0,.04)}
  .composer input:focus{outline:none;border-color:#b9c1ff;box-shadow:0 0 0 3px rgba(124,140,248,.2)}

  @media (max-width:640px){:root{--sidebar-w:260px}.headline{font-size:26px}}

  /* ===== íšŒì›íƒˆí‡´ ëª¨ë‹¬ ===== */
  .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; z-index:80; }
  .modal-wrap{ position:fixed; inset:0; display:grid; place-items:center; z-index:90; pointer-events:none; }
  .modal{ width:min(920px,94vw); border-radius:20px; background:#fff; box-shadow:0 16px 50px rgba(0,0,0,.18);
          padding:28px 28px 34px; transform:translateY(10px); opacity:0; transition:.25s ease;
          pointer-events:auto; }
  .modal.open{ transform:translateY(0); opacity:1; }
  .modal-header{ font-size:20px; font-weight:800; letter-spacing:-.02em; margin-bottom:8px }
  .modal-desc{ color:#4b5563; line-height:1.6; font-size:15px; margin-bottom:18px }
  .modal-list{ margin:0 0 22px 0; padding-left:22px; color:#4b5563 }
  .modal-list b{ color:#111 }
  .cta{ display:block; width:100%; text-align:center; font-size:32px; font-weight:900; letter-spacing:-.02em;
        padding:26px 20px; border:0; border-radius:26px; background:#eef694; cursor:pointer }
  .cta:active{ transform:translateY(1px) }
  .modal-actions{ display:flex; justify-content:flex-end; gap:10px; margin-top:14px }
  .btn{ border:1px solid var(--line); background:#fff; padding:10px 14px; border-radius:10px; cursor:pointer }
</style>
</head>
<body class="sidebar-open">

  <!-- â˜° ë©”ë‰´ -->
  <button class="toggle-btn" id="btn" aria-label="ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°">â˜°</button>

  <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
  <div class="topic" id="topic">
    <button class="topic-btn" id="topicBtn" aria-haspopup="listbox" aria-expanded="false">
      <span id="topicLabel">ì²­ë…„í†¡</span><span class="chev">â–¾</span>
    </button>
    <div class="topic-panel" id="topicPanel" role="listbox" aria-label="ì¹´í…Œê³ ë¦¬">
      <div class="topic-item" data-value="ì²­ë…„í†¡" role="option" aria-selected="true"
        data-tooltip="ë¬´ì£¼íƒ ìš”ê±´ ë° ì†Œë“Â·ìì‚° ê¸°ì¤€ì„ ì¶©ì¡±í•˜ê³  ë‹¤ìŒ ì–´ëŠ í•˜ë‚˜ì— í•´ë‹¹í•˜ëŠ” ë¯¸í˜¼ ì²­ë…„
- ë§Œ 19~39ì„¸ ë¯¸í˜¼ ì²­ë…„
- ëŒ€í•™ìƒ(ì…í•™ ë° ë³µí•™ ì˜ˆì •ì í¬í•¨)
- ì¡¸ì—…Â·ì¤‘í‡´ 2ë…„ ì´ë‚´ ë¯¸ì·¨ì—…ì"
      >
        <p class="topic-title">ì²­ë…„í†¡</p>
        <p class="topic-sub">ì²­ë…„ì˜ ì´ì•¼ê¸°, ì²­ë…„ì„ ìœ„í•œ ëŒ€í™”</p>
      </div>
      <div class="topic-item" data-value="ì‹ í˜¼ë¶€ë¶€í†¡ (I)" role="option"
        data-tooltip="ë¬´ì£¼íƒ ìš”ê±´ ë° ì†Œë“ ìì‚° ê¸°ì¤€ì„ ì¶©ì¡±í•˜ê³  ë‹¤ìŒ ì–´ëŠ í•˜ë‚˜ì— í•´ë‹¹í•˜ëŠ” ê°€êµ¬

â€¢ ì‹ í˜¼ë¶€ë¶€ : ê³µê³ ì¼ ê¸°ì¤€ í˜¼ì¸ 7ë…„ ì´ë‚´ì¸ ì‚¬ëŒ
â€¢ ì˜ˆë¹„ì‹ í˜¼ë¶€ë¶€ : ê³µê³ ì¼ ê¸°ì¤€ í˜¼ì¸ ì˜ˆì •ì¸ ì‚¬ëŒìœ¼ë¡œì„œ ì…ì£¼ì¼ ì „ì¼ê¹Œì§€ í˜¼ì¸ì‹ ê³ ë¥¼ í•˜ëŠ” ì‚¬ëŒ
â€¢ í•œë¶€ëª¨ê°€ì¡± : ë§Œ 6ì„¸ ì´í•˜ ìë…€ë¥¼ ë‘” í•œë¶€ëª¨ê°€ì¡±, ë˜ëŠ” ë¯¸ì„±ë…„ ìë…€ë¥¼ ë‘” ì§€ì›ëŒ€ìƒ í•œë¶€ëª¨ê°€ì¡±
â€¢ ìœ ìë…€ í˜¼ì¸ê°€êµ¬ : ë§Œ 6ì„¸ ì´í•˜ ìë…€ê°€ ìˆëŠ” í˜¼ì¸ê°€êµ¬
â€¢ ì‹ ìƒì•„ ê°€êµ¬ : ë§Œ 2ì„¸ ì´í•˜ ìë…€ê°€ ìˆëŠ” ê°€êµ¬
â€¢ í˜¼ì¸ê°€êµ¬ : ê³µê³ ì¼ ê¸°ì¤€ í˜¼ì¸í•œ ê°€êµ¬"
      >
        <p class="topic-title">ì‹ í˜¼ë¶€ë¶€í†¡ <small>(I)</small></p>
        <p class="topic-sub">ë‘ ì‚¬ëŒì˜ ìƒˆë¡œìš´ ì‹œì‘ì„ í•¨ê»˜í•˜ëŠ” ëŒ€í™”</p>
      </div>
      <div class="topic-item" data-value="ì‹ í˜¼ë¶€ë¶€í†¡ (II)" role="option"
        data-tooltip="ë¬´ì£¼íƒ ìš”ê±´ ë° ì†Œë“ ìì‚° ê¸°ì¤€ì„ ì¶©ì¡±í•˜ê³  ë‹¤ìŒ ì–´ëŠ í•˜ë‚˜ì— í•´ë‹¹í•˜ëŠ” ê°€êµ¬

â€¢ ì‹ í˜¼ë¶€ë¶€ : ê³µê³ ì¼ ê¸°ì¤€ í˜¼ì¸ 7ë…„ ì´ë‚´ì¸ ì‚¬ëŒ
â€¢ ì˜ˆë¹„ì‹ í˜¼ë¶€ë¶€ : ê³µê³ ì¼ ê¸°ì¤€ í˜¼ì¸ ì˜ˆì •ì¸ ì‚¬ëŒìœ¼ë¡œì„œ ì…ì£¼ì¼ ì „ì¼ê¹Œì§€ í˜¼ì¸ì‹ ê³ ë¥¼ í•˜ëŠ” ì‚¬ëŒ
â€¢ í•œë¶€ëª¨ê°€ì¡± : ë§Œ 6ì„¸ ì´í•˜ ìë…€ë¥¼ ë‘” í•œë¶€ëª¨ê°€ì¡±, ë˜ëŠ” ë¯¸ì„±ë…„ ìë…€ë¥¼ ë‘” ì§€ì›ëŒ€ìƒ í•œë¶€ëª¨ê°€ì¡±
â€¢ ìœ ìë…€ í˜¼ì¸ê°€êµ¬ : ë§Œ 6ì„¸ ì´í•˜ ìë…€ê°€ ìˆëŠ” í˜¼ì¸ê°€êµ¬
â€¢ ì‹ ìƒì•„ ê°€êµ¬ : ë§Œ 2ì„¸ ì´í•˜ ìë…€ê°€ ìˆëŠ” ê°€êµ¬
â€¢ í˜¼ì¸ê°€êµ¬ : ê³µê³ ì¼ ê¸°ì¤€ í˜¼ì¸í•œ ê°€êµ¬"
      >
        <p class="topic-title">ì‹ í˜¼ë¶€ë¶€í†¡ <small>(II)</small></p>
        <p class="topic-sub">ë‘ ì‚¬ëŒì˜ ìƒˆë¡œìš´ ì‹œì‘ì„ í•¨ê»˜í•˜ëŠ” ëŒ€í™”</p>
      </div>
    </div>
  </div>

  <!-- ì‚¬ì´ë“œë°” -->
  <aside class="sidebar" id="sidebar">
    <div>
      <div class="sidebar-header">
        <div class="brand" id="brandBtn" title="ì¸íŠ¸ë¡œë¡œ ëŒì•„ê°€ê¸°">Room Mate</div>
        <button id="newChatBtn" class="new-chat">â• ìƒˆ ì±„íŒ…</button>
      </div>
      <div class="sidebar-body" id="chatList"></div>
    </div>
    <div class="sidebar-footer" id="accountBtn" tabindex="0" aria-haspopup="menu" aria-expanded="false">
      <span>ğŸ“§</span><span class="mail" id="user-email">Email@gmail.com</span>
      <div class="account-menu" id="accountMenu" role="menu" aria-label="ê³„ì • ë©”ë‰´">
        <a class="account-item" href="intro.html" role="menuitem">ë¡œê·¸ì•„ì›ƒ</a>
        <a class="account-item" href="password_modify.html" role="menuitem">ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •</a>
        <a class="account-item danger" href="#" id="openWithdraw" role="menuitem" aria-haspopup="dialog">íšŒì›íƒˆí‡´</a>
      </div>
    </div>
  </aside>

  <!-- ì˜¤ë²„ë ˆì´ -->
  <div class="overlay" id="overlay"></div>

  <!-- ===== ì¸íŠ¸ë¡œ í™”ë©´ ===== -->
  <section id="intro" class="main-wrap screen">
    <div class="center">
      <h1 class="headline">ë‚´ ì§‘ ë§ˆë ¨ì˜ ì²«ê±¸ìŒ, <span class="rm-italic">Room&nbsp;Mate</span>ê°€ í•¨ê»˜í•©ë‹ˆë‹¤</h1>
      <p class="sub">ì²­ì•½ë¶€í„° ëŒ€ì¶œê¹Œì§€, ì£¼ê±° ê³ ë¯¼ì€ Room Mateì—ê²Œ ë§¡ê²¨ë³´ì„¸ìš”.</p>
      <div class="search"><input id="landingInput" type="text" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
    </div>
  </section>

  <!-- ===== ì±„íŒ… í™”ë©´ ===== -->
  <section id="chatScreen" class="screen hidden" aria-live="polite" aria-label="ëŒ€í™” í™”ë©´">
    <div class="chat-wrap">
      <div id="chat" class="chat-area"></div>
      <div class="composer"><input id="chatInput" type="text" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
    </div>
  </section>

  <!-- ===== íšŒì›íƒˆí‡´ ëª¨ë‹¬ ===== -->
  <div class="modal-backdrop" id="modalBg" aria-hidden="true"></div>
  <div class="modal-wrap" id="modalWrap" aria-hidden="true">
    <div class="modal" id="withdrawModal" role="dialog" aria-modal="true" aria-labelledby="withdrawTitle" aria-describedby="withdrawDesc">
      <div class="modal-header" id="withdrawTitle">íšŒì› íƒˆí‡´ ì „ ì•ˆë‚´</div>
      <p class="modal-desc" id="withdrawDesc">
        ì§€ê¸ˆê¹Œì§€ Room mate ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ ì£¼ì…”ì„œ ì •ë§ ê°ì‚¬ ë“œë¦½ë‹ˆë‹¤. ë”ìš± ê°œì„ ëœ ì„œë¹„ìŠ¤ë¡œ ì²­ë…„ë“¤ì—ê²Œ ë„ì›€ì´ ë  ìˆ˜ ìˆë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
        íƒˆí‡´í•˜ê¸° ì „ ì•„ë˜ ìœ ì˜ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
      </p>
      <ul class="modal-list">
        <li>íƒˆí‡´í•˜ì‹  ì•„ì´ë””ëŠ” <b>ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥</b>í•©ë‹ˆë‹¤.</li>
        <li>í•´ë‹¹ ì‚¬ìš©ìì˜ ì´ë©”ì¼ ì£¼ì†Œ, ë¹„ë°€ë²ˆí˜¸ì™€ ì§€ê¸ˆê¹Œì§€ ê¸°ë¡ëœ ì±„íŒ… ë‚´ì—­ë“¤ì´ ì‚­ì œë˜ë©°, <b>ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</b>.</li>
      </ul>
      <button class="cta" id="confirmWithdraw">í™•ì¸ ë° íƒˆí‡´í•˜ê¸°</button>
      <div class="modal-actions">
        <button class="btn" id="closeWithdraw">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

<script>
/* ========= ìœ í‹¸ / ìŠ¤í† ë¦¬ì§€ ========= */
const STORAGE_KEY = 'roommate_chats_v1';
const CURRENT_KEY = 'roommate_current_chat_id';
const TOPIC_KEY   = 'roommate_topic';
const DEFAULT_TOPIC = 'ì²­ë…„í†¡';

function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,7); }

function loadChats(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch(e){ return []; } }
function saveChats(chats){ localStorage.setItem(STORAGE_KEY, JSON.stringify(chats)); }
function getCurrentId(){ return localStorage.getItem(CURRENT_KEY); }
function setCurrentId(id){ if(id) localStorage.setItem(CURRENT_KEY, id); else localStorage.removeItem(CURRENT_KEY); }
function getTopic(){ return localStorage.getItem(TOPIC_KEY) || DEFAULT_TOPIC; }
function setTopicLS(t){ localStorage.setItem(TOPIC_KEY, t); }

/* ========= ì „ì—­ ì—˜ë¦¬ë¨¼íŠ¸ ========= */
const body=document.body, btn=document.getElementById('btn'), overlay=document.getElementById('overlay');
const chatListEl=document.getElementById('chatList');
const intro=document.getElementById('intro'), chatScreen=document.getElementById('chatScreen');
const landingIn=document.getElementById('landingInput'), chatArea=document.getElementById('chat'), chatIn=document.getElementById('chatInput');
const topicBtn=document.getElementById('topicBtn'), topicPanel=document.getElementById('topicPanel'), topicLabel=document.getElementById('topicLabel'), topicWrap=document.getElementById('topic');
const newChatBtn=document.getElementById('newChatBtn'); const brandBtn=document.getElementById('brandBtn');

/* ========= ê³µìš© í™”ë©´ ì „í™˜ ========= */
function showChatScreen(){
  intro.classList.add('hidden'); chatScreen.classList.remove('hidden');
  setTimeout(()=>chatIn.focus(),120);
}
function showIntro(){
  chatScreen.classList.add('hidden'); intro.classList.remove('hidden');
  setTimeout(()=>landingIn.focus(),120);
}

/* ========= ì‚¬ì´ë“œë°” í† ê¸€ ========= */
btn.onclick=()=>body.classList.toggle('sidebar-open');
overlay.onclick=()=>body.classList.remove('sidebar-open');
window.addEventListener('keydown',e=>{ if(e.key==='Escape') body.classList.remove('sidebar-open') });

/* ========= ë¸Œëœë“œ í´ë¦­ â†’ ì¸íŠ¸ë¡œë¡œ ========= */
brandBtn.addEventListener('click', showIntro);

/* ========= ê³„ì • íŒì˜¤ë²„ ========= */
document.getElementById('user-email').textContent = "Email@gmail.com";
const accountBtn=document.getElementById('accountBtn'), accountMenu=document.getElementById('accountMenu');
function closeMenu(){accountMenu.classList.remove('open');accountBtn.setAttribute('aria-expanded','false')}
function openMenu(){accountMenu.classList.add('open');accountBtn.setAttribute('aria-expanded','true')}
function toggleMenu(e){e.stopPropagation();accountMenu.classList.contains('open')?closeMenu():openMenu()}
accountBtn.addEventListener('click',toggleMenu);
accountBtn.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){e.preventDefault();toggleMenu(e)} if(e.key==='Escape'){closeMenu()}});
document.addEventListener('click',e=>{ if(!accountBtn.contains(e.target)) closeMenu() });

/* ========= ì¹´í…Œê³ ë¦¬ ========= */
function applyTopicLabel(){ topicLabel.textContent = getTopic(); }
applyTopicLabel();
function openPanel(){ topicPanel.classList.add('open'); topicBtn.setAttribute('aria-expanded','true'); }
function closePanel(){ topicPanel.classList.remove('open'); topicBtn.setAttribute('aria-expanded','false'); }
topicBtn.addEventListener('click', (e)=>{ e.stopPropagation(); topicPanel.classList.contains('open') ? closePanel() : openPanel(); });
document.addEventListener('click', (e)=>{ if(!topicWrap.contains(e.target)) closePanel(); });
topicPanel.querySelectorAll('.topic-item').forEach(it=>{
  it.addEventListener('click',()=>{ setTopicLS(it.dataset.value); applyTopicLabel(); closePanel(); });
});

/* ========= ì„¸ì…˜(ëŒ€í™”) ëª¨ë¸ ========= */
let chats = loadChats();
/*
  chat = { id, title, topic, createdAt, updatedAt, messages:[{role:'user'|'bot', text, ts}] }
*/
function createChat(initialTopic=getTopic()){
  const c = { id: uid(), title:'ìƒˆ ì±„íŒ…', topic: initialTopic, createdAt: Date.now(), updatedAt: Date.now(), messages:[] };
  chats.unshift(c); saveChats(chats); setCurrentId(c.id); renderChatList(); return c;
}
function getChatById(id){ return chats.find(c=>c.id===id); }
function updateChat(c){ c.updatedAt = Date.now(); saveChats(chats); renderChatList(); }
function ensureCurrent(){ let id=getCurrentId(), c=id&&getChatById(id); if(!c){ c=createChat(); } return c; }

/* ========= ì¢Œì¸¡ ëª©ë¡ ë Œë” (â‹¯ ë©”ë‰´ í¬í•¨) ========= */
function humanTime(ts){ const d=new Date(ts); return `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`; }
function closeAllMoreMenus(){ document.querySelectorAll('.more-menu.open').forEach(m=>m.classList.remove('open')); }
function renderChatList(){
  chatListEl.innerHTML=''; chats.sort((a,b)=>b.updatedAt-a.updatedAt);
  chats.forEach(c=>{
    const last = c.messages[c.messages.length-1];

    const item=document.createElement('div'); item.className='chat-item'; item.dataset.id=c.id; item.setAttribute('title', humanTime(c.updatedAt));

    const main=document.createElement('div'); main.className='chat-main';
    const t=document.createElement('div'); t.className='chat-title'; t.textContent=c.title || 'ìƒˆ ì±„íŒ…';
    const s=document.createElement('div'); s.className='chat-snippet'; s.textContent=(last? `${last.role==='user'?'ë‚˜: ':'ë´‡: '}${last.text}` : `${c.topic} â€¢ ëŒ€í™” ì—†ìŒ`);
    main.appendChild(t); main.appendChild(s);

    const moreWrap=document.createElement('div'); moreWrap.className='more-wrap';
    const moreBtn=document.createElement('button'); moreBtn.className='more-btn'; moreBtn.textContent='â‹¯';
    moreBtn.setAttribute('title','ë”ë³´ê¸°'); moreBtn.setAttribute('aria-haspopup','menu');

    const menu=document.createElement('div'); menu.className='more-menu'; menu.setAttribute('role','menu');
    const openItem=document.createElement('div'); openItem.className='mm-item'; openItem.textContent='ì—´ê¸°';
    const delItem=document.createElement('div'); delItem.className='mm-item mm-danger'; delItem.textContent='ì‚­ì œ';

    // ë©”ë‰´ ë™ì‘
    moreBtn.addEventListener('click',(e)=>{ e.stopPropagation(); closeAllMoreMenus(); menu.classList.toggle('open'); });
    document.addEventListener('click',()=>menu.classList.remove('open'));

    openItem.addEventListener('click',(e)=>{ e.stopPropagation(); menu.classList.remove('open'); loadSession(c.id,{gotoChat:true}); });
    delItem.addEventListener('click',(e)=>{
      e.stopPropagation(); menu.classList.remove('open');
      const ok=confirm('ì´ ëŒ€í™”ë¥¼ ì‚­ì œí• ê¹Œìš”? ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); if(!ok) return;
      chats = chats.filter(x=>x.id!==c.id); saveChats(chats);
      if(getCurrentId()===c.id){ setCurrentId(null); clearChatArea(); showIntro(); }
      renderChatList();
    });

    menu.appendChild(openItem); menu.appendChild(delItem);
    moreWrap.appendChild(moreBtn); moreWrap.appendChild(menu);

    item.appendChild(main); item.appendChild(moreWrap);
    item.addEventListener('click',()=>loadSession(c.id,{gotoChat:true}));
    chatListEl.appendChild(item);
  });
}
renderChatList();

/* ========= ì±„íŒ… ì˜ì—­ ========= */
function clearChatArea(){ chatArea.innerHTML=''; }
function bubble(role, text){
  const row=document.createElement('div'); row.className='row ' + (role==='user'?'user':'bot');
  const b=document.createElement('div'); b.className='msg'; b.textContent=text;
  row.appendChild(b); chatArea.appendChild(row); chatArea.scrollTop=chatArea.scrollHeight;
}
function renderSession(c){ clearChatArea(); c.messages.forEach(m=>bubble(m.role, m.text)); }
function loadSession(id,{gotoChat=false}={}){ const c=getChatById(id); if(!c) return; setCurrentId(id); renderSession(c); if(gotoChat) showChatScreen(); }

/* ========= ì…ë ¥ í•¸ë“¤ëŸ¬ ========= */
function addUserMessage(text){
  const c=ensureCurrent(); c.messages.push({role:'user', text, ts:Date.now()});
  if(c.title==='ìƒˆ ì±„íŒ…'){ c.title = text.length>24 ? text.slice(0,24)+'â€¦' : text; }
  updateChat(c); bubble('user', text);
}
function addBotMessage(text){
  const c=ensureCurrent(); c.messages.push({role:'bot', text, ts:Date.now()}); updateChat(c); bubble('bot', text);
}

/* ====== ì¸íŠ¸ë¡œ ì…ë ¥: í´ë¦­ ì´ë™ ì°¨ë‹¨ + ìì—°ìŠ¤ëŸ¬ìš´ ì „í™˜ ====== */
// 1) í´ë¦­ ì‹œ ì–´ë–¤ ê¸°ë³¸ ì´ë™/submitë„ ì°¨ë‹¨ (í˜¹ì‹œ ëª¨ë¥¼ ì”ì—¬ ì½”ë“œ ëŒ€ë¹„)
landingIn.addEventListener('click', (e) => {
  e.preventDefault();
  landingIn.focus();
});

// 2) ì²« ê¸€ì ì…ë ¥ë˜ë©´: ì„¸ì…˜ ìƒì„± â†’ ì±„íŒ…í™”ë©´ ì „í™˜ â†’ ì…ë ¥ê°’ ë™ê¸°í™”
let introMoved=false;
landingIn.addEventListener('input', ()=>{
  if(!introMoved && landingIn.value.length>0){
    introMoved=true;
    createChat(getTopic());           // ìƒˆ ì„¸ì…˜ ìƒì„±
    showChatScreen();                 // í™”ë©´ ì „í™˜
    chatIn.value = landingIn.value;   // ì…ë ¥ê°’ ë„˜ê¹€
    setTimeout(()=>{ chatIn.selectionStart=chatIn.selectionEnd=chatIn.value.length; }, 0);
  }else if(introMoved){
    chatIn.value = landingIn.value;   // ë™ê¸°í™”
  }
});

// 3) ì¸íŠ¸ë¡œì—ì„œ ì—”í„° â†’ ì „ì†¡ ì²˜ë¦¬
landingIn.addEventListener('keydown', (e)=>{
  if(e.key==='Enter'){
    if(!introMoved){
      introMoved=true; createChat(getTopic()); showChatScreen();
      chatIn.value = landingIn.value;
    }
    const v=chatIn.value.trim(); if(!v) return;
    landingIn.value=''; chatIn.value=''; addUserMessage(v);
    setTimeout(()=>addBotMessage('ì„ì‹œ ì‘ë‹µì…ë‹ˆë‹¤. (AI ì—°ê²° ì˜ˆì •)'), 250);
  }
});

/* ì±„íŒ… ì…ë ¥ */
chatIn.addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    const v=chatIn.value.trim(); if(!v) return;
    addUserMessage(v); chatIn.value='';
    setTimeout(()=>addBotMessage('ì„ì‹œ ì‘ë‹µì…ë‹ˆë‹¤. (AI ì—°ê²° ì˜ˆì •)'), 250);
  }
});

/* ìƒˆ ì±„íŒ… ë²„íŠ¼ */
newChatBtn.addEventListener('click', ()=>{
  createChat(getTopic()); clearChatArea(); showChatScreen(); chatIn.value='';
  // ì¸íŠ¸ë¡œ ì…ë ¥ í”Œë˜ê·¸ ì´ˆê¸°í™”
  introMoved=false; landingIn.value='';
});

/* ì²« ë¡œë“œ: ì¸íŠ¸ë¡œ ìœ ì§€ */
if(chats.length===0){ /* keep intro */ }

/* ===== íšŒì›íƒˆí‡´ ëª¨ë‹¬ ===== */
const openWithdraw=document.getElementById('openWithdraw');
const modalBg=document.getElementById('modalBg');
const modalWrap=document.getElementById('modalWrap');
const modal=document.getElementById('withdrawModal');
const closeWithdraw=document.getElementById('closeWithdraw');
const confirmWithdraw=document.getElementById('confirmWithdraw');

function showWithdrawModal(){
  closeMenu(); modalBg.style.display='block';
  modalWrap.setAttribute('aria-hidden','false'); modalBg.setAttribute('aria-hidden','false');
  requestAnimationFrame(()=>{ modal.classList.add('open'); }); confirmWithdraw.focus();
}
function hideWithdrawModal(){
  modal.classList.remove('open'); modalWrap.setAttribute('aria-hidden','true'); modalBg.setAttribute('aria-hidden','true');
  setTimeout(()=>{ modalBg.style.display='none'; }, 200);
}
openWithdraw?.addEventListener('click', (e)=>{ e.preventDefault(); showWithdrawModal(); });
modalBg.addEventListener('click', hideWithdrawModal);
closeWithdraw?.addEventListener('click', hideWithdrawModal);
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modalBg.style.display==='block'){ hideWithdrawModal(); }});
confirmWithdraw?.addEventListener('click', ()=>{ window.location.href = 'intro.html'; });
</script>

</body>
</html>
